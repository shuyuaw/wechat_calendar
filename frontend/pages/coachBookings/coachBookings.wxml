<view class="container page-container-safe-bookings">
  <view class="controls-bar">
    <view class="date-selector">
      <label>显示该日期的预约:</label>
      <picker mode="date" value="{{selectedDate}}" bindchange="onDateChange">
        <view class="picker-display">
          {{selectedDate}}
        </view>
      </picker>
    </view>
    <view class="button-group">
      <button size="mini" type="default" class="nav-button-config" bindtap="goToConfigPage">设置周模版</button>
      <button size="mini" type="primary" bindtap="showAllFutureBookings">显示所有未来预约</button>
    </view>
  </view>

  <view class="booking-list-section">
    <view wx:if="{{isLoading}}" class="loading-message">加载预约中...</view>

    <view wx:if="{{!isLoading && errorMsg}}" class="error-message">
      错误: {{errorMsg}}
    </view>

    <block wx:if="{{!isLoading && !errorMsg}}">
      <view wx:if="{{bookings.length === 0}}" class="no-bookings-message">
        {{selectedDate}} 无预约
      </view>

      <view wx:else class="booking-list">
        <view class="booking-item" wx:for="{{bookings}}" wx:key="_id">
          <view wx:if="{{showAll}}">日期: {{item.displayDate}}</view>
          <view>时间: {{item.displayStartTime}} - {{item.displayEndTime}}</view>
          <view>学员: {{item.userNickName || '未知'}}</view>
        </view>
      </view>
    </block>
  </view>
</view>
